"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[655],{6716:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var n=i(5893),o=i(1151);const s={title:"Fine Tuning"},a=void 0,r={id:"fine-tune",title:"Fine Tuning",description:"Fine tuning process allows the adaptation of pre-trained models to domain-specific data. At this time, AIKit fine tuning process is only supported with NVIDIA GPUs.",source:"@site/docs/fine-tune.md",sourceDirName:".",slug:"/fine-tune",permalink:"/aikit/fine-tune",draft:!1,unlisted:!1,editUrl:"https://github.com/sozercan/aikit/blob/main/website/docs/docs/fine-tune.md",tags:[],version:"current",frontMatter:{title:"Fine Tuning"},sidebar:"sidebar",previous:{title:"Creating Model Images",permalink:"/aikit/create-images"},next:{title:"Vision",permalink:"/aikit/vision"}},d={},l=[{value:"Getting Started",id:"getting-started",level:2},{value:"Targets and Configuration",id:"targets-and-configuration",level:2},{value:"Unsloth",id:"unsloth",level:3},{value:"Build",id:"build",level:2},{value:"What&#39;s next?",id:"whats-next",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Build fails with <code>failed to solve: DeadlineExceeded: context deadline exceeded</code>",id:"build-fails-with-failed-to-solve-deadlineexceeded-context-deadline-exceeded",level:3},{value:"Build fails with <code>ERROR 404: Not Found.</code>",id:"build-fails-with-error-404-not-found",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"Fine tuning process allows the adaptation of pre-trained models to domain-specific data. At this time, AIKit fine tuning process is only supported with NVIDIA GPUs."}),"\n",(0,n.jsxs)(t.admonition,{type:"note",children:[(0,n.jsx)(t.p,{children:"Due to current BuildKit and NVIDIA limitations, your host GPU driver version must match the driver that AIKit will install into the container during build."}),(0,n.jsxs)(t.p,{children:["To find your host GPU driver version, you can run ",(0,n.jsx)(t.code,{children:"nvidia-smi"})," or ",(0,n.jsx)(t.code,{children:"cat /proc/driver/nvidia/version"})]}),(0,n.jsxs)(t.p,{children:["For a list of supported driver versions for AIKit, please refer to ",(0,n.jsx)(t.a,{href:"https://download.nvidia.com/XFree86/Linux-x86_64/",children:"https://download.nvidia.com/XFree86/Linux-x86_64/"})]}),(0,n.jsx)(t.p,{children:"If you don't see your host GPU driver version in that list, you'll need to install one that's matching the version in that list. You don't need to install drivers from that location, only the versions need to match."}),(0,n.jsx)(t.p,{children:"This might be further optimizated in the future to remove this requirement, if possible."})]}),"\n",(0,n.jsx)(t.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,n.jsx)(t.p,{children:"To get started, you need to create a builder to be able to access host GPU devices."}),"\n",(0,n.jsx)(t.p,{children:"Create a builder with the following configuration:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"docker buildx create --name aikit-builder --use --buildkitd-flags '--allow-insecure-entitlement security.insecure'\n"})}),"\n",(0,n.jsx)(t.h2,{id:"targets-and-configuration",children:"Targets and Configuration"}),"\n",(0,n.jsxs)(t.p,{children:["AIKit is capable of supporting multiple fine tuning implementation targets. At this time, ",(0,n.jsx)(t.a,{href:"https://github.com/unslothai/unsloth",children:"Unsloth"})," is the only supported target, but can be extended for other fine tuning implementations in the future."]}),"\n",(0,n.jsx)(t.h3,{id:"unsloth",children:"Unsloth"}),"\n",(0,n.jsx)(t.p,{children:"Create a YAML file with your configuration. For example, minimum config looks like:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"#syntax=ghcr.io/sozercan/aikit:latest\napiVersion: v1alpha1\nbaseModel: unsloth/llama-2-7b-bnb-4bit # base model to be fine tuned. this can be any model from Huggingface. For unsloth optimized base models, see https://huggingface.co/unsloth\ndatasets:\n  - source: yahma/alpaca-cleaned # data set to be used for fine tuning. This can be a Huggingface dataset or a URL pointing to a JSON file\n    type: alpaca # type of dataset. only alpaca is supported at this time.\nconfig:\n  unsloth:\n"})}),"\n",(0,n.jsxs)(t.p,{children:["For full configuration, please refer to ",(0,n.jsx)(t.a,{href:"/aikit/specs-finetune",children:"Fine Tune API Specifications"})]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["Please refer to ",(0,n.jsx)(t.a,{href:"https://github.com/unslothai/unsloth",children:"Unsloth documentation"})," for more information about Unsloth configuration."]})}),"\n",(0,n.jsx)(t.h2,{id:"build",children:"Build"}),"\n",(0,n.jsxs)(t.p,{children:["Build using following command and make sure to replace ",(0,n.jsx)(t.code,{children:"--target"})," with the fine-tuning implementation of your choice (",(0,n.jsx)(t.code,{children:"unsloth"})," is the only option supported at this time), ",(0,n.jsx)(t.code,{children:"--file"})," with the path to your configuration YAML and ",(0,n.jsx)(t.code,{children:"--output"})," with the output directory of the finetuned model."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'docker buildx build --builder aikit-builder --allow security.insecure --file "/path/to/config.yaml" --output "/path/to/output" --target unsloth --progress plain .\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Depending on your setup and configuration, build process may take some time. At the end of the build, the fine-tuned model will automatically be quantized with the specified format and output to the path specified in the ",(0,n.jsx)(t.code,{children:"--output"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Output will be a ",(0,n.jsx)(t.code,{children:"GGUF"})," model file with the name and quanization format from the configuration. For example:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"$ ls -al _output\n-rw-r--r--  1 sozercan sozercan 7161089856 Mar  3 00:19 aikit-model-q4_k_m.gguf\n"})}),"\n",(0,n.jsx)(t.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,n.jsxs)(t.p,{children:["\ud83d\udc49 Now that you have a fine-tuned model output as a GGUF file, you can refer to ",(0,n.jsx)(t.a,{href:"/aikit/create-images",children:"Creating Model Images"})," on how to create an image with AIKit to serve your fine-tuned model!"]}),"\n",(0,n.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,n.jsxs)(t.h3,{id:"build-fails-with-failed-to-solve-deadlineexceeded-context-deadline-exceeded",children:["Build fails with ",(0,n.jsx)(t.code,{children:"failed to solve: DeadlineExceeded: context deadline exceeded"})]}),"\n",(0,n.jsxs)(t.p,{children:["This is a known issue with BuildKit and might be related to disk speed. For more information, please see ",(0,n.jsx)(t.a,{href:"https://github.com/moby/buildkit/issues/4327",children:"https://github.com/moby/buildkit/issues/4327"})]}),"\n",(0,n.jsxs)(t.h3,{id:"build-fails-with-error-404-not-found",children:["Build fails with ",(0,n.jsx)(t.code,{children:"ERROR 404: Not Found."})]}),"\n",(0,n.jsx)(t.p,{children:"This is due to mismatching host and container GPU driver versions. Please refer to the note at the top of this page for more information."}),"\n",(0,n.jsxs)(t.p,{children:["If you are on Windows Subsystem for Linux (WSL), WSL doesn't expose the host driver version information on ",(0,n.jsx)(t.code,{children:"/proc/driver/nvidia/version"}),". Due to this limitation, WSL is not supported at this time."]})]})}function u(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},1151:(e,t,i)=>{i.d(t,{Z:()=>r,a:()=>a});var n=i(7294);const o={},s=n.createContext(o);function a(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);